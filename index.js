(function () {var a={props:["backup","downloading"]};if(typeof a==="function"){a=a.options}Object.assign(a,function(){var render=function(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("li",{staticClass:"backup-entry"},[_c("div",{staticClass:"backup-filename"},[_c("k-icon",{attrs:{"type":"backup"}}),_vm._v(" "),_c("span",[_vm._v(_vm._s(_vm.backup.filename))])],1),_vm._v(" "),_c("div",{staticClass:"backup-size"},[_vm._v(_vm._s(_vm.backup.size))]),_vm._v(" "),_c("div",{staticClass:"backup-date"},[_vm._v(_vm._s(_vm.backup.date))]),_vm._v(" "),_c("div",{staticClass:"backup-actions"},[!_vm.downloading?_c("k-button",{staticClass:"backup-download",attrs:{"icon":"download"},on:{"click":function($event){return _vm.$emit("download",_vm.backup.filename)}}},[_vm._v(_vm._s(_vm.$t("backups.download")))]):_c("k-button",{staticClass:"backup-download",attrs:{"icon":"backupsLoader","disabled":true}},[_vm._v(_vm._s(_vm.$t("backups.downloading")))]),_vm._v(" "),_c("k-button",{attrs:{"icon":"trash","theme":"negative"},on:{"click":function($event){return _vm.$emit("delete")}}})],1)])};var staticRenderFns=[];return{render:render,staticRenderFns:staticRenderFns,_compiled:true,_scopeId:null,functional:undefined}}());var b={components:{"backup-entry":a},data:function(){return{backups:[],downloading:!1,toDelete:{},creationStatus:"default"}},mounted:function(){var t=this;this.$api.get("backups/get-backups-list").then(function(e){t.backups=e}),window.beforeunload=this.deletePublicBackups()},destroyed:function(){this.deletePublicBackups()},methods:{createBackup:function(){var t=this;this.creationStatus="progress",this.$api.get("plugin-janitor/backupZip").then(function(e){if(t.setCreationStatus(e.status,!0),200==e.status){var i={filename:e.filename+".zip",size:e.nicesize,date:e.modified};t.backups.unshift(i)}}).catch(function(e){t.setCreationStatus("error",!0)})},setCreationStatus:function(t){var e=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.creationStatus=200==t?"success":"error",i&&setTimeout(function(){e.creationStatus="default"},2e3)},deletePublicBackups:function(){this.$api.post("backups/delete-public-backups")},copyAndDownload:function(t){var e=this;this.downloading=t,t="latest"==t?this.backups[0].filename:t,this.$api.get("backups/copy-to-assets",{filename:t}).then(function(t){t.url&&(window.location=t.url),e.downloading=!1})},openDeleteDialog:function(t){this.toDelete=t,this.$refs["delete-dialog"].open()},resetDelete:function(){this.toDelete={}},deleteBackup:function(){var t=this;this.$api.post("backups/delete-backup",{filename:this.toDelete.filename}).then(function(e){e.deleted&&(t.backups=t.backups.filter(function(e){return e.filename!==t.toDelete.filename})),t.$refs["delete-dialog"].close()})}}};if(typeof b==="function"){b=b.options}Object.assign(b,function(){var render=function(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("k-view",{staticClass:"k-backups-view"},[_c("k-header",{staticClass:"k-backups-view-header"},[_vm._v(" "+_vm._s(_vm.$t("view.backups"))+" "),_c("k-button-group",{attrs:{"slot":"left"},slot:"left"},[_vm.creationStatus=="default"?_c("k-button",{attrs:{"icon":"add"},on:{"click":_vm.createBackup}},[_vm._v(_vm._s(_vm.$t("backups.create")))]):_vm.creationStatus=="progress"?_c("k-button",{attrs:{"icon":"backupsLoader","disabled":true}},[_vm._v(_vm._s(_vm.$t("backups.create.process")))]):_vm.creationStatus=="success"?_c("k-button",{attrs:{"icon":"check","disabled":true,"theme":"positive"}},[_vm._v(_vm._s(_vm.$t("backups.create.success")))]):_vm.creationStatus=="error"?_c("k-button",{attrs:{"icon":"alert","disabled":true,"theme":"negative"}},[_vm._v(_vm._s(_vm.$t("backups.create.error")))]):_vm._e()],1),_vm._v(" "),_vm.backups.length?_c("k-button-group",{attrs:{"slot":"right"},slot:"right"},[_vm.downloading!=="latest"?_c("k-button",{attrs:{"icon":"download"},on:{"click":function($event){return _vm.copyAndDownload("latest")}}},[_vm._v(_vm._s(_vm.$t("backups.download.latest")))]):_c("k-button",{attrs:{"icon":"backupsLoader","disabled":true}},[_vm._v(_vm._s(_vm.$t("backups.downloading")))])],1):_vm._e()],1),_vm._v(" "),_vm.backups.length?_c("section",{staticClass:"backups-section"},[_c("header",{staticClass:"backups-header"},[_c("div",{staticClass:"backup-filename"},[_vm._v(_vm._s(_vm.$t("backups.filename")))]),_vm._v(" "),_c("div",{staticClass:"backup-size"},[_vm._v(_vm._s(_vm.$t("backups.size")))]),_vm._v(" "),_c("div",{staticClass:"backup-date"},[_vm._v(_vm._s(_vm.$t("backups.created")))])]),_vm._v(" "),_c("ul",{staticClass:"backups-list"},_vm._l(_vm.backups,function(backup){return _c("backup-entry",{key:backup.filename,attrs:{"backup":backup,"downloading":_vm.downloading==backup.filename},on:{"download":_vm.copyAndDownload,"delete":function($event){return _vm.openDeleteDialog(backup)}}})}),1)]):_c("div",{staticClass:"backups-placeholder"},[_vm._v(" "+_vm._s(_vm.$t("backups.placeholder"))+" ")]),_vm._v(" "),_c("k-dialog",{ref:"delete-dialog",attrs:{"size":"medium","theme":"negative","icon":"trash","button":_vm.$t("backups.delete.button")},on:{"close":_vm.resetDelete,"cancel":_vm.resetDelete,"submit":_vm.deleteBackup}},[_c("k-text",[_vm._v(_vm._s(_vm.$t("backups.delete.prefix"))+" "),_c("strong",[_vm._v(_vm._s(this.toDelete.filename))])])],1)],1)};var staticRenderFns=[];return{render:render,staticRenderFns:staticRenderFns,_compiled:true,_scopeId:null,functional:undefined}}());panel.plugin("sylvainjule/backups",{views:{backups:{component:b,icon:"backups"}},icons:{backups:"<path d=\"M15.33,6.67H.67A.67.67,0,0,1,0,6V.67A.67.67,0,0,1,.67,0H15.33A.67.67,0,0,1,16,.67V6A.67.67,0,0,1,15.33,6.67Zm-14-1.33H14.67v-4H1.33Zm14,9.33H.67A.67.67,0,0,1,0,14V8.67A.67.67,0,0,1,.67,8H15.33a.67.67,0,0,1,.67.67V14A.67.67,0,0,1,15.33,14.67Zm-14-1.33H14.67v-4H1.33Zm5.33-10A.67.67,0,0,0,6,2.67H3.33A.67.67,0,0,0,3.33,4H6A.67.67,0,0,0,6.67,3.33Zm0,8A.67.67,0,0,0,6,10.67H3.33a.67.67,0,0,0,0,1.33H6A.67.67,0,0,0,6.67,11.33Zm6-8.67a.67.67,0,1,1-.67.67A.67.67,0,0,1,12.67,2.67Zm0,8a.67.67,0,1,1-.67.67A.67.67,0,0,1,12.67,10.67Z\"/>",backup:"<path d=\"M7.12,11.86a.56.56,0,0,1-.4-.16l-2-2a.56.56,0,0,1,.79-.79L7.12,10.5l3.56-3.56a.56.56,0,0,1,.79.79l-4,4A.56.56,0,0,1,7.12,11.86Z\"/><path d=\"M14,15.45H2.17A2.17,2.17,0,0,1,0,13.28V1.41A.69.69,0,0,1,.69.72H6.13a.69.69,0,0,1,.59.33L8,3.19h7.52a.69.69,0,0,1,.69.69v9.4A2.17,2.17,0,0,1,14,15.45ZM1.38,2.1V13.28a.8.8,0,0,0,.79.79H14a.8.8,0,0,0,.8-.79V4.57H7.61A.69.69,0,0,1,7,4.23L5.74,2.1Z\"/>",backupsLoader:"<g fill=\"none\" fill-rule=\"evenodd\"><g transform=\"translate(1 1)\" stroke-width=\"1.75\"><circle cx=\"7\" cy=\"7\" r=\"7.2\" stroke=\"#000\" stroke-opacity=\".2\"/><path d=\"M14.2,7c0-4-3.2-7.2-7.2-7.2\" stroke=\"#000\"><animateTransform attributeName=\"transform\" type=\"rotate\" from=\"0 7 7\" to=\"360 7 7\" dur=\"1s\" repeatCount=\"indefinite\"/></path></g></g>"}});})();